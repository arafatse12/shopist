var designer=designer||{},designerCanvasObj,selectedObj,designer_settings_data,designer_img_elements,design_save_json_data,$lineHeightRange,$textShadowX,$textShadowY,$shadowBlur,$textOpacity,$curveRadius,$curveSpacing,$imgOpacity,ary=[],prev_canvobj=0,canvDataobj={},baseURL="",designerLocalizationString;designer.onPageLoad={_designer_init:function(){if($("#hf_base_url").length>0&&(baseURL=$("#hf_base_url").val()),$("#frontend_all_msg_with_localization").length>0&&(designerLocalizationString=JSON.parse($("#frontend_all_msg_with_localization").val())),$("#designer_canvas").length>0&&$("#hf_designer_settings_json").length>0&&$("#hf_custom_designer_data").length>0&&$("#hf_designer_settings_json").val()&&$("#hf_custom_designer_data").val()){if($("#hf_designer_settings_json").length>0&&$("#hf_designer_settings_json").val().length>0&&(designer_settings_data=JSON.parse($("#hf_designer_settings_json").val())),$("#hf_custom_designer_data").length>0&&$("#hf_custom_designer_data").val().length>0&&(designer_img_elements=JSON.parse($("#hf_custom_designer_data").val())),$("#hf_design_save_json_data").length>0&&$("#hf_design_save_json_data").val().length>0&&(design_save_json_data=$.parseJSON($("#hf_design_save_json_data").val())),$("#swap-popover-content").find(".design-title-items").length>0&&(prev_canvobj=$("#swap-popover-content .design-title-items:first-child").data("id")),designerCanvasObj=new fabric.Canvas("designer_canvas"),designer.function._resizeCanvas(),designerCanvasObj.on("selection:cleared",designer.function._designer_view_clear),designerCanvasObj.on("object:selected",designer.function._designer_viewObject),($(".designer-text-control").length>0||$(".designer-image-gallery").length>0||$(".designer-image-edit-panel").length>0||$(".designer-upload-image").length>0)&&$(".designer-text-control, .designer-image-gallery, .designer-image-edit-panel, .designer-upload-image").draggable({handle:"#draggable-handle"}),$(".canvas-design-panel .panel-body").length>0&&$(".canvas-design-panel .panel-body").mCustomScrollbar({autoHideScrollbar:!0,theme:"dark"}),$(".designer-text-control #change_fonts").length>0&&$(".designer-text-control #change_fonts").select2({width:"100%"}),$("#text_line_height").length>0){var a=$("#text_line_height");a.ionRangeSlider({min:.1,max:10,type:"single",step:.1,postfix:"",prettify:!1,hasGrid:!1,onChange:function(a){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||(selectedObj.set($("#text_line_height").data("name"),a.from),designerCanvasObj.renderAll())}}),$lineHeightRange=a.data("ionRangeSlider")}if($("#change_text_x_shadow").length>0){var b=$("#change_text_x_shadow");b.ionRangeSlider({min:-10,max:40,type:"single",step:1,postfix:"",prettify:!1,hasGrid:!1,onChange:function(a){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||designer.function._shadow_elements($("#change_text_x_shadow"),a.from)}}),$textShadowX=b.data("ionRangeSlider")}if($("#change_text_y_shadow").length>0){var c=$("#change_text_y_shadow");c.ionRangeSlider({min:0,max:40,type:"single",step:1,postfix:"",prettify:!1,hasGrid:!1,onChange:function(a){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||designer.function._shadow_elements($("#change_text_y_shadow"),a.from)}}),$textShadowY=c.data("ionRangeSlider")}if($("#change_text_blur_shadow").length>0){var d=$("#change_text_blur_shadow");d.ionRangeSlider({min:0,max:40,type:"single",step:1,postfix:"",prettify:!1,hasGrid:!1,onChange:function(a){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||designer.function._shadow_elements($("#change_text_blur_shadow"),a.from)}}),$shadowBlur=d.data("ionRangeSlider")}if($("#change_text_opacity").length>0){var e=$("#change_text_opacity");e.ionRangeSlider({min:0,max:1,type:"single",step:.01,postfix:"",prettify:!1,hasGrid:!1,onChange:function(a){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||(selectedObj.set("opacity",a.from),designerCanvasObj.renderAll())}}),$textOpacity=e.data("ionRangeSlider")}if($("#change_img_opacity").length>0){var f=$("#change_img_opacity");f.ionRangeSlider({min:0,max:1,type:"single",step:.01,postfix:"",prettify:!1,hasGrid:!1,onChange:function(a){!selectedObj||"gallery_image"!==selectedObj.itemName&&"upload_image"!==selectedObj.itemName||(selectedObj.set("opacity",a.from),designerCanvasObj.renderAll())}}),$textOpacity=e.data("ionRangeSlider")}if($("#change_radius").length>0){var g=$("#change_radius");g.ionRangeSlider({min:0,max:200,type:"single",step:1,postfix:"",prettify:!1,hasGrid:!1,onChange:function(a){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||(selectedObj.set($("#change_radius").data("name"),a.from),designerCanvasObj.renderAll())}}),$curveRadius=g.data("ionRangeSlider")}if($("#change_spacing").length>0){var h=$("#change_spacing");h.ionRangeSlider({min:5,max:40,type:"single",step:1,postfix:"",prettify:!1,hasGrid:!1,onChange:function(a){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||(selectedObj.set($("#change_spacing").data("name"),a.from),designerCanvasObj.renderAll())}}),$curveSpacing=h.data("ionRangeSlider")}if(fabric.Object.prototype.setControlsVisibility({ml:!1,mr:!1,bl:!1,mb:!1,mt:!1,tr:!1}),fabric.Canvas.prototype.customiseControls({tl:{action:"rotate",cursor:"crosshair"},br:{action:"scale"}}),$("#downloadImgLink").length>0){var i=document.getElementById("downloadImgLink");i.addEventListener("click",function(a){allPanelHide();var b=designerCanvasObj.toDataURL("image/png");i.href=b})}$(".icon-img-pdf").length>0&&$(".icon-img-pdf").click(function(){allPanelHide();var a=designerCanvasObj.toDataURL("image/png"),b=new jsPDF("p","mm");b.addImage(a,"PNG",10,10),b.save("product.pdf")}),$(".icon-img-print").length>0&&$(".icon-img-print").click(function(){allPanelHide();var a=window.open();a.document.write("<img src='"+designerCanvasObj.toDataURL()+"'/>"),a.print(),a.location.reload()})}}},designer.event={_chnage_dynamic_text:function(){$("#change_dynamic_text").length>0&&$("#change_dynamic_text").keyup(function(){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||designer.function._design_rearrange_again("edit_text",$(this))})},_chnage_dynamic_text_fonts:function(){$("#change_fonts").length>0&&$("#change_fonts").change(function(){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||designer.function._design_rearrange_again("change_fonts_family",$(this))})},_chnage_dynamic_color:function(){($("#change_text_color").length>0||$("#change_img_color").length>0)&&$("#change_text_color, #change_img_color").change(function(){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName?!selectedObj||"gallery_image"!==selectedObj.itemName&&"upload_image"!==selectedObj.itemName||designer.function._design_rearrange_again("change_img_color",$(this)):designer.function._design_rearrange_again("change_text_color",$(this))})},_chnage_dynamic_text_align:function(){$(".text-align").length>0&&$(".text-align li").click(function(){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||designer.function._design_rearrange_again("change_alignment",$(this))})},_chnage_dynamic_text_fontWeight:function(){$(".text-font-weight").length>0&&$(".text-font-weight li").click(function(){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||designer.function._design_rearrange_again("change_style",$(this))})},_chnage_dynamic_text_decoration:function(){$(".textDecoration").length>0&&$(".textDecoration li").click(function(){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||designer.function._design_rearrange_again("change_decoration",$(this))})},_chnage_dynamic_text_shadow:function(){$("#change_text_shadow_color").length>0&&$("#change_text_shadow_color").change(function(){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||designer.function._shadow_elements($(this),$(this).val())})},_chnage_dynamic_more_options:function(){($(".dynamic-text-more-option").length>0||$(".dynamic-img-more-option").length>0)&&$(".dynamic-text-more-option ul li, .dynamic-img-more-option ul li").click(function(){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName&&"gallery_image"!==selectedObj.itemName&&"upload_image"!==selectedObj.itemName||designer.function._design_rearrange_again("more_action",$(this))})},_enable_curved_text:function(){$("#enableCurvedText").length>0&&$("#enableCurvedText").click(function(){if(selectedObj&&("normal_text"===selectedObj.itemName||"curvedText"===selectedObj.itemName)){var c,a={},b=selectedObj;b&&($(this).is(":checked")?(/text/.test(b.type)&&(default_text=b.getText(),a=b.toObject(),delete a.type,a.textAlign="center",a.radius=50,a.spacing=20,a.itemName="curvedText",a.hasRotatingPoint=!1,a.padding=10,c=new fabric.CurvedText(default_text,a)),$(".curved-text-elements").fadeIn()):(/curvedText/.test(b.type)&&(default_text=b.getText(),a=b.toObject(),delete a.type,a.itemName="normal_text",a.hasRotatingPoint=!1,a.padding=10,c=new fabric.Text(default_text,a)),$(".curved-text-elements").fadeOut()),designerCanvasObj.remove(b),designerCanvasObj.add(c).renderAll(),designerCanvasObj.setActiveObject(c))}})},_remove_selected_object:function(){$(".remove-selected-object").length>0&&$(".remove-selected-object").click(function(){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName&&"gallery_image"!==selectedObj.itemName&&"upload_image"!==selectedObj.itemName||designerCanvasObj.remove(selectedObj)})},_curved_text_reverse_change:function(){$("#enableCurvedTextReverse").length>0&&$("#enableCurvedTextReverse").on("click",function(){!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName||designer.function._design_rearrange_again("reverse",$(this))})},_remove_design_modal:function(){$(".close-design-control-modal").length>0&&$(".close-design-control-modal").on("click",function(){$(this).parent().parent().fadeOut(),canvasDeactivateAll(),"gallery"==$(this).data("name")&&show_gallery_image_cat_list()})},_save_custom_design:function(){$("#save_custom_design").length>0&&$("#save_custom_design").on("click",function(a){a.preventDefault(),allPanelHide(),designerCanvasObj.deactivateAll().renderAll(),canvDataobj[prev_canvobj]={objId:prev_canvobj,customdata:JSON.stringify(designerCanvasObj.toJSON(["id","name","itemName","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockRotation","hasControls","hasBorders","lockSystem","textAlign","radius","spacing","hasRotatingPoint","padding","angle","strokeWidth","stroke","borderColor","cornerSize","cornerShape","cornerBackgroundColor","cornerPadding","reverse","shadow","filters"])),screenShot:designerCanvasObj.toDataURL()};for(var b in canvDataobj)delete canvDataobj[b].screenShot;$(".ajax-overlay, .ajax-overlay").show(),$.ajax({url:baseURL+"/ajax/save_custom_data",type:"POST",cache:!1,headers:{"X-XSRF-TOKEN":$("#_token").val()},data:{product_id:$("#product_id").val(),_data:canvDataobj},success:function(a){a.status&&"success"===a.status&&(window.location.href=window.location.href)},error:function(){}})})},_remove_custom_design:function(){$("#remove_custom_design").length>0&&$("#remove_custom_design").on("click",function(a){a.preventDefault(),allPanelHide(),$.ajax({url:baseURL+"/ajax/remove_custom_data",type:"POST",cache:!1,headers:{"X-XSRF-TOKEN":$("#_token").val()},data:{product_id:$("#product_id").val()},success:function(a){a.status&&"deleted"===a.status&&(window.location.href=window.location.href)},error:function(){}})})},_add_to_cart_process:function(){$(".customize-page-add-to-cart").length>0&&$(".customize-page-add-to-cart").on("click",function(){var a=$(this),b=[];allPanelHide(),canvDataobj[prev_canvobj]={objId:prev_canvobj,customdata:JSON.stringify(designerCanvasObj.toJSON(["id","name","itemName","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockRotation","hasControls","hasBorders","lockSystem","textAlign","radius","spacing","hasRotatingPoint","padding","angle","strokeWidth","stroke","borderColor","cornerSize","cornerShape","cornerBackgroundColor","cornerPadding","reverse","shadow","filters"])),screenShot:designerCanvasObj.toDataURL()};for(var c in canvDataobj){var d={};d.name="custom_design_product_"+canvDataobj[c].objId,d.file=createBlob(canvDataobj[c].screenShot),b.push(d)}for(var e=new FormData,f=0;f<b.length;f++)e.append(b[f].name,b[f].file);$("#cart_page_overlay").show();var g=new XMLHttpRequest;g.open("POST",baseURL+"/ajax/save_custom_design_img"),g.setRequestHeader("X-XSRF-TOKEN",$("#hf_token").val()),g.send(e),g.onreadystatechange=function(){if(4===g.readyState&&200==g.status){var b=$.parseJSON(g.responseText);designer.function._final_step_for_add_to_cart_process(canvDataobj,a,b._access_token)}}})}},designer.function={_resizeCanvas:function(){designer.function._objectResize()},_objectResize:function(){var a,b;screen.width<=500?(a=designer_settings_data.canvas_dimension.small_devices.width?designer_settings_data.canvas_dimension.small_devices.width:280,b=designer_settings_data.canvas_dimension.small_devices.height?designer_settings_data.canvas_dimension.small_devices.height:300):screen.width<=768&&screen.width>=501?(a=designer_settings_data.canvas_dimension.medium_devices.width?designer_settings_data.canvas_dimension.medium_devices.width:480,b=designer_settings_data.canvas_dimension.medium_devices.height?designer_settings_data.canvas_dimension.medium_devices.height:480):screen.width>=769&&(a=designer_settings_data.canvas_dimension.large_devices.width?designer_settings_data.canvas_dimension.large_devices.width:500,b=designer_settings_data.canvas_dimension.large_devices.height?designer_settings_data.canvas_dimension.large_devices.height:550),designerCanvasObj.setWidth(a),designerCanvasObj.setHeight(b),$(".canvas-design-panel").length>0&&$(".canvas-container-main").length>0&&($(".canvas-design-panel").css({width:parseInt(a),height:parseInt(b)}),$(".canvas-container-main").css({width:parseInt(a)+150,height:parseInt(b)+150})),design_save_json_data&&$("#hf_design_save_json_data").val().length>0?loadSaveJsonToCanvas(prev_canvobj):($("#track_is_loaded_first").length>0&&$("#track_is_loaded_first").val()&&designer.function._design_bg_img_load($("#track_is_loaded_first").val()),$("#track_is_trans_loaded_first").length>0&&$("#track_is_trans_loaded_first").val()&&designer.function._design_trans_img_load($("#track_is_trans_loaded_first").val())),designerCanvasObj.renderAll(),designerCanvasObj.calcOffset()},_add_dynamic_text_to_design:function(){var a=new fabric.Text("Enter Your Text",{angle:0,fontSize:20,fill:"#444444",itemName:"normal_text",hasRotatingPoint:!1,fontFamily:"arial",padding:10,lockSystem:!1});designerCanvasObj.add(a),designerCanvasObj.centerObject(a),designerCanvasObj.setActiveObject(a),a.setCoords(),designerCanvasObj.calcOffset(),designerCanvasObj.renderAll()},_image_gallery:function(){$(".designer-image-gallery").show(),show_gallery_image_cat_list()},_image_upload_option:function(){$(".designer-upload-image").show()},_designer_view_clear:function(){allPanelHide()},_designer_viewObject:function(){if(selectedObj=designerCanvasObj.getActiveObject(),selectedObj&&designer.function._fabric_control_icon_change(selectedObj),!selectedObj||"normal_text"!==selectedObj.itemName&&"curvedText"!==selectedObj.itemName)!selectedObj||"gallery_image"!==selectedObj.itemName&&"upload_image"!==selectedObj.itemName||($(".designer-image-edit-panel").show(),"block"===$(".designer-text-control").css("display")&&$(".designer-text-control").hide());else if($(".designer-text-control").length>0){if($(".designer-text-control #change_dynamic_text").val(selectedObj.getText()),"normal_text"===selectedObj.itemName?$("#enableCurvedText").is(":checked")&&($("#enableCurvedText").prop("checked",!1),$(".curved-text-elements").fadeOut()):"curvedText"===selectedObj.itemName&&($("#enableCurvedText").not(":checked")&&($("#enableCurvedText").prop("checked",!0),$curveRadius.update({from:selectedObj.radius}),$curveSpacing.update({from:selectedObj.spacing}),$(".curved-text-elements").fadeIn()),selectedObj.reverse?$("#enableCurvedTextReverse").prop("checked",!0):$("#enableCurvedTextReverse").prop("checked",!1)),selectedObj.getFontFamily()&&$("#change_fonts").select2("val",selectedObj.getFontFamily()),selectedObj.getLineHeight()&&$lineHeightRange.update({from:selectedObj.getLineHeight()}),selectedObj.getFill()&&($("#change_text_color").val(selectedObj.getFill().split("#")[1]),$("#change_text_color").css("background-color",selectedObj.getFill())),selectedObj.getOpacity()&&$textOpacity.update({from:selectedObj.getOpacity()}),selectedObj.getShadow()){var a=selectedObj.getShadow();$("#change_text_shadow_color").val(a.color.split("#")[1]),$("#change_text_shadow_color").css("background-color",a.color),$textShadowX.update({from:a.offsetX}),$textShadowY.update({from:a.offsetY}),$shadowBlur.update({from:a.blur})}else $("#change_text_shadow_color").val("FFFFFF"),$("#change_text_shadow_color").css("background-color","#FFFFFF"),$textShadowX.update({from:-10}),$textShadowY.update({from:0}),$shadowBlur.update({from:0});selectedObj.lockSystem?$(".object-lock").length>0&&$(".object-lock").find("span").removeClass().addClass("icon-object-unlock"):$(".object-lock").length>0&&$(".object-lock").find("span").removeClass().addClass("icon-object-lock"),$(".designer-text-control").show(),"block"===$(".designer-image-edit-panel").css("display")&&$(".designer-image-edit-panel").hide(),"block"===$(".designer-image-gallery").css("display")&&$(".designer-image-gallery").hide()}},_fabric_control_icon_change:function(a){a.customiseCornerIcons({settings:{borderColor:"#6B7983",cornerSize:20,cornerShape:"rect",cornerBackgroundColor:"#6B7983",cornerPadding:9},tl:{icon:"/public/designer/icons/rotate.png"},br:{icon:"/public/designer/icons/resize.png"}},function(){designerCanvasObj.renderAll()})},_design_bg_img_load:function(a){a&&designerCanvasObj.setBackgroundImage(a,designerCanvasObj.renderAll.bind(designerCanvasObj),{backgroundImageStretch:!1,width:parseInt(designerCanvasObj.getWidth()-20),height:parseInt(designerCanvasObj.getHeight()-20),left:10,top:10})},_design_trans_img_load:function(a){a&&designerCanvasObj.setOverlayImage(a,designerCanvasObj.renderAll.bind(designerCanvasObj),{width:parseInt(designerCanvasObj.getWidth()-20),height:parseInt(designerCanvasObj.getHeight()-20),left:10,top:10})},_design_rearrange_again:function(a,b){if("edit_text"===a)selectedObj.setText(b.val());else if("change_fonts_family"===a)selectedObj.set(b.data("name"),b.val());else if("change_text_color"===a)selectedObj.set(b.data("name"),"#"+b.val());else if("change_img_color"===a){var c=new fabric.Image.filters.Tint({color:b.val()});selectedObj.filters.push(c),selectedObj.applyFilters(designerCanvasObj.renderAll.bind(designerCanvasObj))}else"change_alignment"===a?"align-left"===b.attr("class")?selectedObj.set("textAlign","left"):"align-center"===b.attr("class")?selectedObj.set("textAlign","center"):"align-right"===b.attr("class")&&selectedObj.set("textAlign","right"):"change_style"===a?"normal"===b.attr("class")?(selectedObj.set("fontWeight","normal"),selectedObj.set("fontStyle","normal")):"bold"===b.attr("class")?selectedObj.set("fontWeight","bold"):"italic"===b.attr("class")&&selectedObj.set("fontStyle","italic"):"change_decoration"===a?"underline"===b.attr("class")?selectedObj.set("textDecoration","underline"):"line-through"===b.attr("class")?selectedObj.set("textDecoration","line-through"):"overline"===b.attr("class")?selectedObj.set("textDecoration","overline"):"none"===b.attr("class")&&selectedObj.set("textDecoration",""):"more_action"===a?"flip-x"===b.data("name")?(1==selectedObj.getFlipY()&&selectedObj.set("flipY",!1),selectedObj.set("flipX",!0)):"flip-y"===b.data("name")?(1==selectedObj.getFlipX()&&selectedObj.set("flipX",!1),selectedObj.set("flipY",!0)):"move-front"===b.data("name")?designerCanvasObj.bringToFront(selectedObj):"move-back"===b.data("name")?designerCanvasObj.sendToBack(selectedObj):"lock"===b.data("name")&&b.find(".icon-object-lock").length>0?(selectedObj.set({lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0,lockRotation:!0,hasControls:!1,hasBorders:!1,lockSystem:!0}),b.find(".icon-object-lock").removeClass("icon-object-lock").addClass("icon-object-unlock"),canvasDeactivateActiveObject()):"lock"===b.data("name")&&b.find(".icon-object-unlock").length>0&&(selectedObj.set({lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1,lockRotation:!1,hasControls:!0,hasBorders:!0,lockSystem:!1}),b.find(".icon-object-unlock").removeClass("icon-object-unlock").addClass("icon-object-lock"),canvasDeactivateActiveObject()):"reverse"===a&&selectedObj.set(b.data("name"),b.is(":checked"));designerCanvasObj.renderAll()},_shadow_elements:function(a,b){var c,d,e=0,f=0,g=0;selectedObj&&(d=selectedObj.getShadow()),"color"===a.data("name")?c="#"+a.val():d&&(c=d.color),"offset_x"===a.data("name")?e=b:d&&(e=d.offsetX),"offset_y"===a.data("name")?f=b:d&&(f=d.offsetY),"blur"===a.data("name")?g=b:d&&(g=d.blur),selectedObj.set("shadow",{color:c,blur:g,offsetX:e,offsetY:f}),designerCanvasObj.renderAll()},_dynamic_image_add_at_design:function(a,b){if(b){var c=_makeid(),d="";d="upload_image"===a?"upload_image":"gallery_image";var e=new Image;e.src=b,e.onload=function(){var a=new fabric.Image(e);a.set({itemName:d,id:c,hasRotatingPoint:!1,lockSystem:!1,padding:10});var b=_scaleImageSize(100,110,a.getWidth(),a.getHeight());a.setWidth(b[0]),a.setHeight(b[1]),designerCanvasObj.add(a),designerCanvasObj.setActiveObject(a),designerCanvasObj.centerObject(a),a.setCoords(),designerCanvasObj.calcOffset(),designerCanvasObj.renderAll()}}},_img_preview:function(){$("#designPreview").length>0&&($("#designPreview .modal-body img").attr("src",designerCanvasObj.toDataURL()),$("#designPreview").modal("show"))},_manage_swap_content:function(a){var b=a.data("id");allPanelHide(),canvDataobj[prev_canvobj]={objId:prev_canvobj,customdata:JSON.stringify(designerCanvasObj.toJSON(["id","name","itemName","lockMovementX","lockMovementY","lockScalingX","lockScalingY","lockRotation","hasControls","hasBorders","lockSystem","textAlign","radius","spacing","hasRotatingPoint","padding","angle","strokeWidth","stroke","borderColor","cornerSize","cornerShape","cornerBackgroundColor","cornerPadding","reverse","shadow","filters"])),screenShot:designerCanvasObj.toDataURL()},designerCanvasObj.clear(),prev_canvobj=b,"undefined"!=typeof canvDataobj[b]?(designerCanvasObj.loadFromJSON(canvDataobj[b].customdata,function(){var a=designerCanvasObj.getObjects().length,b=function(){0==--a&&designerCanvasObj.renderAll()};designerCanvasObj.forEachObject(function(a){"image"===a.type&&a.filters.length&&a.applyFilters(b)})}),a.data("design_trans_img_url")||(designerCanvasObj.overlayImage=null,designerCanvasObj.renderAll.bind(designerCanvasObj))):design_save_json_data&&$("#hf_design_save_json_data").val().length>0?(loadSaveJsonToCanvas(b),a.data("design_trans_img_url")||(designerCanvasObj.overlayImage=null,designerCanvasObj.renderAll.bind(designerCanvasObj))):(a.data("design_img_url")&&designer.function._design_bg_img_load(a.data("design_img_url")),a.data("design_trans_img_url")?designer.function._design_trans_img_load(a.data("design_trans_img_url")):(designerCanvasObj.overlayImage=null,designerCanvasObj.renderAll.bind(designerCanvasObj)))},_final_step_for_add_to_cart_process:function(a,b,c){var d={};d.product_id=b.data("id"),$("#quantity").length>0?d.qty=parseInt($("#quantity").val()):d.qty=1,$("#selected_variation_id").length>0&&$("#selected_variation_id").val()&&(d.variation_id=parseInt($("#selected_variation_id").val()));for(var e in a)"undefined"!=a[e].screenShot&&delete a[e].screenShot;a&&(d.customizeData=a),c&&(d.accessToken=c),$.ajax({url:baseURL+"/ajax/customize-product-add-to-cart",type:"POST",cache:!1,headers:{"X-XSRF-TOKEN":$("#hf_token").val()},data:d,success:function(a){$("#cart_page_overlay").hide(),a&&"zero_price"==a?swal("",designerLocalizationString.designer_price_can_not_zero):a&&"out_of_stock"==a?swal("",designerLocalizationString.designer_product_out_of_stock):a&&"item_added"==a&&swal({title:designerLocalizationString.designer_item_added_successfully,text:designerLocalizationString.designer_cart_page_view,type:"info",showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0},function(){$("#cart_url").length>0&&(window.location.href=$("#cart_url").val())})},error:function(){}})}};var canvasDeactivateAll=function(){designerCanvasObj.deactivateAll(),designerCanvasObj.renderAll()},canvasDeactivateActiveObject=function(){designerCanvasObj.discardActiveObject(),designerCanvasObj.renderAll()},getItemByName=function(a){var b=null;return designerCanvasObj.forEachObject(function(c){if(c.name===a)return b=c,!1}),b},loadSaveJsonToCanvas=function(a){var b="";$.each(design_save_json_data,function(c,d){if(c===a)return b=d.customdata,!1}),b&&designerCanvasObj.loadFromJSON(b,function(){var a=designerCanvasObj.getObjects().length,b=function(){0==--a&&designerCanvasObj.renderAll()};designerCanvasObj.forEachObject(function(a){"image"===a.type&&a.filters.length?a.applyFilters(b):b()})})};$(document).ready(function(){designer.onPageLoad._designer_init()});